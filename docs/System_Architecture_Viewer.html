<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°±æ¥­è¦å‰‡RAGã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Custom styles for specific component behaviors */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f8f7f4;
            /* Warm neutral background */
            color: #1f2937;
        }

        .component-box {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .component-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-color: #4b5563;
        }

        .component-box.active {
            ring: 2px;
            ring-color: #3b82f6;
            background-color: #eff6ff;
            border-color: #3b82f6;
        }

        .flow-step {
            transition: all 0.5s ease;
            opacity: 0.5;
            transform: scale(0.95);
        }

        .flow-step.active {
            opacity: 1;
            transform: scale(1);
            background-color: #fff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #3b82f6;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
    </style>
    <!-- Chosen Palette: Warm Professional (Warm Grey Bg, Slate/Blue Accents, White Cards) -->
    <!-- Application Structure Plan: 
         1. Header: Project Context.
         2. Main Nav: Tabs for 'System Map', 'Data Pipeline', 'RAG Workflow', 'Resource Monitor'.
         3. System Map (Architecture): Interactive block diagram representing the HP Z620 host and containers. Clicking blocks reveals specs.
         4. Flows (Pipeline/Workflow): Step-by-step interactive visualizations showing logic flow.
         5. Resources: Chart.js visualization of RAM allocation.
         Rationale: Breaks down the complex markdown report into consumable visual layers. -->
    <!-- Visualization & Content Choices: 
         - Architecture: HTML Grid Layout with click interactions. Replaces static Mermaid. Goal: Inform/Organize.
         - Data/RAG Flows: Vertical stepper with 'Play' controls. Goal: Change/Process.
         - Resources: Doughnut Chart. Goal: Relationships/Proportions.
         - CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>

<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <span class="text-2xl">ğŸ—ï¸</span>
                <h1 class="text-xl font-bold text-gray-800">å°±æ¥­è¦å‰‡RAGã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ <span
                        class="text-sm font-normal text-gray-500 ml-2">HP Z620 / Local Host</span></h1>
            </div>
            <div class="text-sm text-gray-500">System Design v1.0</div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">

        <!-- Intro Section -->
        <section class="mb-8 bg-white p-6 rounded-lg shadow-sm border border-gray-100">
            <h2 class="text-lg font-semibold text-gray-800 mb-2">ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦</h2>
            <p class="text-gray-600 leading-relaxed">
                æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€å˜ä¸€ãƒ›ã‚¹ãƒˆï¼ˆHP Z620ï¼‰ä¸Šã§Dockerã‚³ãƒ³ãƒ†ãƒŠæŠ€è¡“ã‚’ç”¨ã„ã¦æ§‹ç¯‰ã•ã‚Œã‚‹ã€Œå°±æ¥­è¦å‰‡RAGãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã€ã®ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸ã‚’å¯è¦–åŒ–ã—ãŸã‚‚ã®ã§ã™ã€‚
                ä¸‹ã®ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã€ç‰©ç†æ§‹æˆã€ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã€æ¨è«–ãƒ—ãƒ­ã‚»ã‚¹ã€ãŠã‚ˆã³ãƒªã‚½ãƒ¼ã‚¹é…åˆ†ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
            </p>
        </section>

        <!-- Navigation Tabs -->
        <div class="border-b border-gray-200 mb-6">
            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                <button onclick="switchTab('arch')" id="tab-arch"
                    class="tab-btn border-b-2 border-blue-500 py-4 px-1 text-sm font-medium text-blue-600 hover:text-blue-800"
                    aria-current="page">
                    ç‰©ç†ãƒ»è«–ç†æ§‹æˆå›³
                </button>
                <button onclick="switchTab('data')" id="tab-data"
                    class="tab-btn border-b-2 border-transparent py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    â‘  ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
                </button>
                <button onclick="switchTab('rag')" id="tab-rag"
                    class="tab-btn border-b-2 border-transparent py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    â‘¡ æ¨è«–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
                </button>
                <button onclick="switchTab('resource')" id="tab-resource"
                    class="tab-btn border-b-2 border-transparent py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    ãƒªã‚½ãƒ¼ã‚¹é…åˆ† (64GB)
                </button>
            </nav>
        </div>

        <!-- VIEW 1: System Architecture (Interactive Map) -->
        <div id="view-arch" class="view-section space-y-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Interactive Diagram Column -->
                <div class="lg:col-span-2 space-y-4">
                    <div class="bg-gray-50 p-6 rounded-xl border border-dashed border-gray-300">
                        <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-4">ğŸ–¥ï¸ Physical Host: HP
                            Z620 (Linux / WSL2)</h3>

                        <!-- Python Layer -->
                        <div class="mb-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                            <h4 class="text-xs font-bold text-yellow-700 mb-3">ğŸ Python Environment (Local/Container)
                            </h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div onclick="showDetails('scraper')"
                                    class="component-box bg-white p-3 rounded shadow-sm border border-yellow-100 flex items-center space-x-2">
                                    <span class="text-xl">ğŸ•·ï¸</span>
                                    <div>
                                        <div class="font-bold text-gray-700 text-sm">Scraper</div>
                                        <div class="text-xs text-gray-500">Requests/BS4</div>
                                    </div>
                                </div>
                                <div onclick="showDetails('processor')"
                                    class="component-box bg-white p-3 rounded shadow-sm border border-yellow-100 flex items-center space-x-2">
                                    <span class="text-xl">âš™ï¸</span>
                                    <div>
                                        <div class="font-bold text-gray-700 text-sm">Processor</div>
                                        <div class="text-xs text-gray-500">MD Converter</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Storage Layer -->
                        <div onclick="showDetails('storage')"
                            class="component-box mb-6 p-3 bg-gray-100 rounded-lg border border-gray-300 flex items-center justify-center space-x-3 text-gray-600 hover:bg-gray-200">
                            <span>ğŸ’¾</span>
                            <span class="font-medium text-sm">Local Storage (data/processed/)</span>
                        </div>

                        <!-- Docker Layer -->
                        <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                            <h4 class="text-xs font-bold text-blue-700 mb-3">ğŸ³ Docker Layer (Single Host Network)</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Dify Cluster -->
                                <div class="space-y-3">
                                    <div class="text-xs font-semibold text-blue-500 text-center">Dify Cluster</div>
                                    <div onclick="showDetails('dify-ui')"
                                        class="component-box bg-white p-3 rounded shadow-sm border border-blue-100 flex items-center justify-between">
                                        <span class="text-sm font-bold text-gray-700">Dify Web UI</span>
                                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Port:
                                            80</span>
                                    </div>
                                    <div onclick="showDetails('dify-api')"
                                        class="component-box bg-white p-3 rounded shadow-sm border border-blue-100 flex items-center justify-between">
                                        <span class="text-sm font-bold text-gray-700">API Server</span>
                                        <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">Backend</span>
                                    </div>
                                    <div onclick="showDetails('vectordb')"
                                        class="component-box bg-white p-3 rounded shadow-sm border border-blue-100 flex items-center justify-between">
                                        <span class="text-sm font-bold text-gray-700">Vector DB</span>
                                        <span
                                            class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded">pgvector</span>
                                    </div>
                                </div>

                                <!-- Inference Engine -->
                                <div class="space-y-3 border-l border-blue-200 pl-4 md:pl-6">
                                    <div class="text-xs font-semibold text-purple-500 text-center">Inference Engine
                                    </div>
                                    <div onclick="showDetails('ollama')"
                                        class="component-box bg-white p-4 rounded shadow-sm border border-purple-100 flex flex-col items-center justify-center h-full">
                                        <span class="text-2xl mb-2">ğŸ¦™</span>
                                        <span class="text-sm font-bold text-gray-700">Ollama API</span>
                                        <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded mt-2">Port:
                                            11434</span>
                                        <span class="text-xs text-gray-400 mt-1">Llama 3.1 8B</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- External Source -->
                    <div class="flex justify-center">
                        <div class="h-8 w-0.5 bg-gray-300"></div>
                    </div>
                    <div class="text-center">
                        <div
                            class="inline-flex items-center space-x-2 bg-white px-4 py-2 rounded-full border border-gray-200 shadow-sm text-sm text-gray-500">
                            <span>ğŸŒ</span>
                            <span>External: è‡ªæ²»ä½“ä¾‹è¦é›†ã‚µã‚¤ãƒˆ (Reiki-Base)</span>
                        </div>
                    </div>
                </div>

                <!-- Info Panel -->
                <div class="lg:col-span-1">
                    <div
                        class="sticky top-24 bg-white p-6 rounded-xl shadow-lg border border-gray-200 h-full max-h-[600px] overflow-y-auto">
                        <div class="flex items-center space-x-2 mb-4">
                            <span class="text-2xl">â„¹ï¸</span>
                            <h3 class="text-lg font-bold text-gray-800">Component Details</h3>
                        </div>
                        <div id="info-content" class="text-gray-600 text-sm leading-relaxed">
                            <p class="text-gray-400 italic">å·¦ã®å›³ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW 2: Data Pipeline -->
        <div id="view-data" class="view-section hidden space-y-6">
            <div class="bg-white p-6 rounded-xl border border-gray-200">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 class="text-lg font-bold text-gray-800">â‘  ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ (Data Ingestion)</h3>
                        <p class="text-sm text-gray-500">è‡ªæ²»ä½“ã‚µã‚¤ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€RAGãƒŠãƒ¬ãƒƒã‚¸ã¨ã—ã¦ç™»éŒ²ã™ã‚‹ã¾ã§ã®ãƒ•ãƒ­ãƒ¼ã€‚</p>
                    </div>
                    <button onclick="playFlow('data')"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors shadow-sm flex items-center">
                        <span class="mr-2">â–¶</span> ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
                    </button>
                </div>

                <div class="space-y-4 max-w-3xl mx-auto" id="flow-container-data">
                    <!-- Steps will be injected by JS -->
                </div>
            </div>
        </div>

        <!-- VIEW 3: RAG Workflow -->
        <div id="view-rag" class="view-section hidden space-y-6">
            <div class="bg-white p-6 rounded-xl border border-gray-200">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 class="text-lg font-bold text-gray-800">â‘¡ æ¨è«–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (RAG Workflow)</h3>
                        <p class="text-sm text-gray-500">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã‹ã‚‰å›ç­”ç”Ÿæˆã¾ã§ã®ãƒ—ãƒ­ã‚»ã‚¹ã€‚</p>
                    </div>
                    <button onclick="playFlow('rag')"
                        class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors shadow-sm flex items-center">
                        <span class="mr-2">â–¶</span> ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
                    </button>
                </div>

                <div class="space-y-4 max-w-3xl mx-auto" id="flow-container-rag">
                    <!-- Steps will be injected by JS -->
                </div>
            </div>
        </div>

        <!-- VIEW 4: Resources -->
        <div id="view-resource" class="view-section hidden space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Chart Section -->
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex flex-col items-center">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">ãƒ¡ãƒ¢ãƒªå‰²ã‚Šå½“ã¦ (RAM: 64GB)</h3>
                    <p class="text-sm text-gray-500 mb-6 text-center">æ¨è«–ã‚¨ãƒ³ã‚¸ãƒ³(Ollama)ã¸ã®é‡ç‚¹é…åˆ†è¨­è¨ˆ</p>

                    <div class="chart-container">
                        <canvas id="ramChart"></canvas>
                    </div>
                </div>

                <!-- Specs Text -->
                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">ãƒªã‚½ãƒ¼ã‚¹é…åˆ†è¦ä»¶</h3>
                        <ul class="space-y-4 text-sm text-gray-600">
                            <li class="flex items-start">
                                <span
                                    class="bg-purple-100 text-purple-800 p-1 rounded mr-3 text-xs font-bold mt-0.5">Ollama</span>
                                <span>
                                    <strong>32GB (50%)</strong><br>
                                    SLMï¼ˆLlama 3.1 8Bç­‰ï¼‰ã®ãƒ¢ãƒ‡ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’VRAMä¸è¶³æ™‚ã«ã‚·ã‚¹ãƒ†ãƒ RAMã¸å±•é–‹ã™ã‚‹ãŸã‚ã«æœ€å¤§ç¢ºä¿ã€‚
                                </span>
                            </li>
                            <li class="flex items-start">
                                <span class="bg-blue-100 text-blue-800 p-1 rounded mr-3 text-xs font-bold mt-0.5">Dify
                                    Cluster</span>
                                <span>
                                    <strong>16GB (25%)</strong><br>
                                    API Server, Web UI, Workerã«åŠ ãˆã€PostgreSQL (Vector DB)ã¨Redisã®å‹•ä½œé ˜åŸŸã€‚
                                </span>
                            </li>
                            <li class="flex items-start">
                                <span
                                    class="bg-gray-100 text-gray-800 p-1 rounded mr-3 text-xs font-bold mt-0.5">System/OS</span>
                                <span>
                                    <strong>16GB (25%)</strong><br>
                                    ãƒ›ã‚¹ãƒˆOS (Windows/WSL2) ãŠã‚ˆã³ãã®ä»–ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ç”¨ã€‚
                                </span>
                            </li>
                        </ul>
                    </div>

                    <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ & ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</h3>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="p-3 bg-gray-50 rounded border border-gray-100">
                                <div class="font-bold text-gray-700 text-sm mb-1">Network Strategy</div>
                                <div class="text-xs text-gray-600">
                                    Docker Bridge Networkã‚’ä½¿ç”¨ã€‚<br>
                                    <code>host.docker.internal</code> ã‚’ä»‹ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠé–“é€šä¿¡ã‚’ç¢ºç«‹ã€‚
                                </div>
                            </div>
                            <div class="p-3 bg-gray-50 rounded border border-gray-100">
                                <div class="font-bold text-gray-700 text-sm mb-1">Storage Strategy</div>
                                <div class="text-xs text-gray-600">
                                    SSDä¸Šã«Docker Volumeã‚’ãƒã‚¦ãƒ³ãƒˆã€‚<br>
                                    Vector DBã®I/Oãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’å›é¿ã€‚
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        // --- Data Definitions ---
        const componentData = {
            'scraper': {
                title: 'Scraper (Python)',
                role: 'Data Collection',
                tech: 'Requests, BeautifulSoup4',
                desc: 'è‡ªæ²»ä½“ã®Webã‚µã‚¤ãƒˆï¼ˆReiki-Baseãªã©ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ä¾‹è¦é›†ã®HTMLãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚è‡ªå‹•å·¡å›ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã¿ã¾ã™ã€‚'
            },
            'processor': {
                title: 'Processor (Python)',
                role: 'Data Transformation',
                tech: 'Custom Parsing Logic',
                desc: 'å–å¾—ã—ãŸHTMLã‹ã‚‰ã€Œç¬¬1ç« ã€ã€Œç¬¬1æ¡ã€ãªã©ã®éšå±¤æ§‹é€ ã‚’è§£æã—ã€DifyãŒç†è§£ã—ã‚„ã™ã„Markdownå½¢å¼ã«å¤‰æ›ãƒ»åˆ†å‰²ã—ã¾ã™ã€‚'
            },
            'storage': {
                title: 'Local Storage',
                role: 'Intermediate Persistence',
                tech: 'File System (data/processed/)',
                desc: 'åŠ å·¥æ¸ˆã¿ã®Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€æ™‚ä¿å­˜ã™ã‚‹å ´æ‰€ã§ã™ã€‚ã“ã“ã‹ã‚‰Difyã¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒè¡Œã‚ã‚Œã¾ã™ã€‚'
            },
            'dify-ui': {
                title: 'Dify Web UI',
                role: 'User Interface',
                tech: 'Next.js / Nginx',
                port: 'Port: 80',
                desc: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒãƒ£ãƒƒãƒˆã‚’è¡Œã†ãŸã‚ã®ãƒ–ãƒ©ã‚¦ã‚¶ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€‚ç®¡ç†ç”»é¢æ©Ÿèƒ½ã‚‚æä¾›ã—ã¾ã™ã€‚'
            },
            'dify-api': {
                title: 'Dify API Server',
                role: 'Orchestration Core',
                tech: 'Flask / Python',
                port: 'Port: 5001',
                desc: 'RAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®åˆ¶å¾¡ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ§‹ç¯‰ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®çµåˆã‚’è¡Œã†ä¸­æ ¸ã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚'
            },
            'vectordb': {
                title: 'Vector DB',
                role: 'Knowledge Store',
                tech: 'PostgreSQL + pgvector',
                port: 'Port: 5432',
                desc: 'æ¡æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã¨ã®é¡ä¼¼åº¦æ¤œç´¢ï¼ˆSemantic Searchï¼‰ã‚’æ‹…å½“ã—ã¾ã™ã€‚'
            },
            'ollama': {
                title: 'Ollama API',
                role: 'Inference Engine',
                tech: 'Ollama / SLM',
                port: 'Port: 11434',
                desc: 'ãƒ­ãƒ¼ã‚«ãƒ«ã§è»½é‡è¨€èªãƒ¢ãƒ‡ãƒ«ï¼ˆLlama 3.1 8Bãªã©ï¼‰ã‚’å‹•ä½œã•ã›ã‚‹ãŸã‚ã®ã‚¨ãƒ³ã‚¸ãƒ³ã€‚Difyã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œã˜ã¦ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆã‚’è¡Œã„ã¾ã™ã€‚'
            }
        };

        const flows = {
            'data': [
                { title: '1. Scraping', desc: 'Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒè‡ªæ²»ä½“ã‚µã‚¤ãƒˆï¼ˆä¸Šé–¢ç”ºç­‰ï¼‰ã‹ã‚‰ä¾‹è¦HTMLã‚’å–å¾—ã€‚', icon: 'ğŸ•·ï¸' },
                { title: '2. Preprocessing', desc: 'éšå±¤æ§‹é€ ï¼ˆç« ãƒ»ç¯€ãƒ»æ¡ï¼‰ã‚’è§£æã—ã€Markdownå½¢å¼ã«å¤‰æ›ã€‚', icon: 'âš™ï¸' },
                { title: '3. Storage', desc: 'åŠ å·¥æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚©ãƒ«ãƒ€(data/processed/)ã«ä¿å­˜ã€‚', icon: 'ğŸ’¾' },
                { title: '4. Ingestion', desc: 'Difyã®ãƒŠãƒ¬ãƒƒã‚¸æ©Ÿèƒ½ã§ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã€ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã—ã¦DBã¸ç™»éŒ²ã€‚', icon: 'ğŸ“¥' }
            ],
            'rag': [
                { title: '1. Query', desc: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒDify Web UIã‹ã‚‰è³ªå•ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šã€Œæœ‰çµ¦ã¯ä½•æ—¥ï¼Ÿã€ï¼‰ã€‚', icon: 'ğŸ‘¤' },
                { title: '2. Search', desc: 'DifyãŒè³ªå•ã‚’ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã—ã€Vector DBã‹ã‚‰é–¢é€£ã™ã‚‹æ¡æ–‡ã‚’æ¤œç´¢ã€‚', icon: 'ğŸ”' },
                { title: '3. Synthesis', desc: 'ã€Œæ¤œç´¢ã•ã‚ŒãŸæ¡æ–‡ã€ã¨ã€Œè³ªå•ã€ã‚’çµ„ã¿åˆã‚ã›ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½œæˆã€‚', icon: 'ğŸ“' },
                { title: '4. Generation', desc: 'Ollama APIã¸ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’é€ä¿¡ã—ã€SLMãŒå›ç­”ã‚’ç”Ÿæˆã€‚', icon: 'ğŸ§ ' },
                { title: '5. Output', desc: 'ç”Ÿæˆã•ã‚ŒãŸå›ç­”ã«å‡ºå…¸ï¼ˆç¬¬â—¯æ¡ï¼‰ã‚’ä»˜ä¸ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤ºã€‚', icon: 'ğŸ’¬' }
            ]
        };

        // --- Interaction Logic ---

        // Tab Switching
        function switchTab(tabId) {
            // Hide all views
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            // Show selected view
            document.getElementById(`view-${tabId}`).classList.remove('hidden');

            // Update tab styles
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('border-blue-500', 'text-blue-600');
                el.classList.add('border-transparent', 'text-gray-500');
            });
            const activeTab = document.getElementById(`tab-${tabId}`);
            activeTab.classList.remove('border-transparent', 'text-gray-500');
            activeTab.classList.add('border-blue-500', 'text-blue-600');

            // Init chart if resource tab is selected and not init
            if (tabId === 'resource' && !window.ramChartInstance) {
                initChart();
            }
        }

        // Architecture View: Show Details
        function showDetails(componentId) {
            const data = componentData[componentId];
            if (!data) return;

            // Highlight active box
            document.querySelectorAll('.component-box').forEach(el => el.classList.remove('active'));
            // Find the element clicked (using event delegation assumption or direct logic)
            // Ideally passing 'this' or finding by ID would be better, but we rely on simple class toggle here for clicked item visual
            // Since we pass ID, we need to find element with onclick matching this ID for perfect highlight, 
            // but for simplicity we will just render the content.

            const content = `
                <div class="space-y-4 animate-fade-in">
                    <div>
                        <h4 class="text-xl font-bold text-gray-800">${data.title}</h4>
                        <div class="flex items-center space-x-2 mt-1">
                            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded uppercase tracking-wide">${data.role}</span>
                            ${data.port ? `<span class="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded font-mono">${data.port}</span>` : ''}
                        </div>
                    </div>
                    
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-100">
                        <div class="text-xs font-bold text-gray-500 uppercase mb-1">Technology Stack</div>
                        <div class="text-sm font-medium text-gray-800">${data.tech}</div>
                    </div>

                    <div>
                        <div class="text-xs font-bold text-gray-500 uppercase mb-1">Description</div>
                        <p class="leading-relaxed text-gray-700">${data.desc}</p>
                    </div>
                </div>
            `;
            document.getElementById('info-content').innerHTML = content;
        }

        // Flow Visualization Logic
        function renderFlows() {
            ['data', 'rag'].forEach(type => {
                const container = document.getElementById(`flow-container-${type}`);
                container.innerHTML = flows[type].map((step, index) => `
                    <div id="flow-${type}-${index}" class="flow-step p-4 rounded-lg border border-l-4 border-gray-200 bg-gray-50 flex items-start space-x-4">
                        <div class="flex-shrink-0 bg-white p-2 rounded-full shadow-sm text-xl border border-gray-100">
                            ${step.icon}
                        </div>
                        <div>
                            <h4 class="font-bold text-gray-800">${step.title}</h4>
                            <p class="text-sm text-gray-600 mt-1">${step.desc}</p>
                        </div>
                    </div>
                `).join('');
            });
        }

        let flowTimeouts = [];
        function playFlow(type) {
            // Clear existing timeouts
            flowTimeouts.forEach(t => clearTimeout(t));
            flowTimeouts = [];

            const steps = flows[type];
            // Reset all
            steps.forEach((_, i) => {
                const el = document.getElementById(`flow-${type}-${i}`);
                el.classList.remove('active', 'border-blue-500');
                el.classList.add('border-gray-200');
            });

            // Play sequence
            steps.forEach((_, i) => {
                const timeout = setTimeout(() => {
                    // Deactivate previous
                    if (i > 0) {
                        const prev = document.getElementById(`flow-${type}-${i - 1}`);
                        prev.classList.remove('active', 'border-blue-500');
                        prev.classList.add('border-gray-200');
                    }

                    // Activate current
                    const curr = document.getElementById(`flow-${type}-${i}`);
                    curr.classList.add('active', 'border-blue-500');
                    curr.classList.remove('border-gray-200');
                    curr.scrollIntoView({ behavior: 'smooth', block: 'center' });

                }, i * 1500); // 1.5s per step
                flowTimeouts.push(timeout);
            });

            // Finish state
            const finalTimeout = setTimeout(() => {
                const last = document.getElementById(`flow-${type}-${steps.length - 1}`);
                last.classList.remove('active', 'border-blue-500');
                last.classList.add('border-gray-200');
            }, steps.length * 1500 + 1000);
            flowTimeouts.push(finalTimeout);
        }

        // Chart.js Initialization
        function initChart() {
            const ctx = document.getElementById('ramChart').getContext('2d');
            window.ramChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Ollama (SLM)', 'Dify Cluster', 'System/OS'],
                    datasets: [{
                        data: [32, 16, 16],
                        backgroundColor: [
                            '#a855f7', // Purple for Ollama
                            '#3b82f6', // Blue for Dify
                            '#9ca3af'  // Gray for System
                        ],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: { size: 12 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return ` ${context.label}: ${context.raw} GB`;
                                }
                            }
                        }
                    },
                    cutout: '65%'
                }
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderFlows();
            // Default select first item info
            showDetails('scraper');
        });

    </script>
</body>

</html>